<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/blog-project/img/icon.svg"><meta name="keywords" content="空城机的个人博客网页"><meta name="description" content="空城机的个人博客网页"><meta name="author" content="空城机"><meta name="robots" content="all"><title>NodeJs深入浅出之旅：内存控制（上）🐍 | 空城机の博文</title>
    <link rel="modulepreload" href="/blog-project/assets/app.44e72aae.js"><link rel="modulepreload" href="/blog-project/assets/NodeJs深入浅出之旅：内存控制（上）.html.5a890c8b.js"><link rel="modulepreload" href="/blog-project/assets/NodeJs深入浅出之旅：内存控制（上）.html.5b1fb9ab.js"><link rel="prefetch" href="/blog-project/assets/index.html.161b75e1.js"><link rel="prefetch" href="/blog-project/assets/hpjs01.html.f7499281.js"><link rel="prefetch" href="/blog-project/assets/hpjs02.html.4f82158a.js"><link rel="prefetch" href="/blog-project/assets/hpjs03.html.e62eb624.js"><link rel="prefetch" href="/blog-project/assets/hpjs04.html.9b39117d.js"><link rel="prefetch" href="/blog-project/assets/hpjs05.html.6deda07a.js"><link rel="prefetch" href="/blog-project/assets/hpjs06.html.7ea9db31.js"><link rel="prefetch" href="/blog-project/assets/hpjs07.html.e2a74ff7.js"><link rel="prefetch" href="/blog-project/assets/hpjs08.html.1fd81f10.js"><link rel="prefetch" href="/blog-project/assets/Node の MongoDB Driver.html.d1fdf9cd.js"><link rel="prefetch" href="/blog-project/assets/node の SQLite.html.12b9c49d.js"><link rel="prefetch" href="/blog-project/assets/Node1.html.f08d3b58.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：V8内存分配.html.de400e4a.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：内存控制（下）.html.0f186650.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：包与NPM.html.2c7cae0c.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：异步I!O （上）.html.678bb07e.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：异步I!O （下）.html.7322f321.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：异步I!O （中）.html.0f136407.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：文件系统.html.da2e01e3.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：模块.html.c4e9c91a.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：理解Buffer.html.ebd88974.js"><link rel="prefetch" href="/blog-project/assets/node爬虫爬取小说章节.html.e85e86c6.js"><link rel="prefetch" href="/blog-project/assets/Node连接MongoDB（一）.html.f2b4b4df.js"><link rel="prefetch" href="/blog-project/assets/SocketIO の 聊天练习.html.52613a4f.js"><link rel="prefetch" href="/blog-project/assets/Three.Js杂记1.html.200b30ab.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记10.html.5fab9db9.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记11.html.de0f1fe9.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记12.html.ec8a90d2.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记2.html.3ef0b8b5.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记3.html.077a5517.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记4.html.10543aca.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记5.html.6f2c18e4.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记6.html.e3f8ed1e.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记7.html.1f21cb9d.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记8.html.5d23eb35.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记9.html.e7b34647.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの一.html.e9107c53.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの七：函数.html.793fb401.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの三：TS的类型.html.d847df80.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの九：接口Interfaces · 中.html.2ab2acdb.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの二.html.f4d9d8ec.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの五：webpack打包typescript.html.9ef80ab9.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの八：类.html.aaad1a2f.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの六：webpack5热更新打包TS.html.bca03910.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十一：模块和命名空间.html.3c51e1fa.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十三： infer、extends、keyof、typeof、in.html.4d284b77.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十二：装饰器.html.66f7813a.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十：泛型.html.f6fac11e.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの四：接口Interfaces · 上.html.9cb0611a.js"><link rel="prefetch" href="/blog-project/assets/404.html.ab74ef0a.js"><link rel="prefetch" href="/blog-project/assets/index.html.3eae7e8c.js"><link rel="prefetch" href="/blog-project/assets/index.html.972cef0d.js"><link rel="prefetch" href="/blog-project/assets/index.html.d56af7fe.js"><link rel="prefetch" href="/blog-project/assets/index.html.5d5d36d9.js"><link rel="prefetch" href="/blog-project/assets/index.html.101d55cf.js"><link rel="prefetch" href="/blog-project/assets/index.html.e9d306f5.js"><link rel="prefetch" href="/blog-project/assets/index.html.033f1827.js"><link rel="prefetch" href="/blog-project/assets/index.html.5dfdadd1.js"><link rel="prefetch" href="/blog-project/assets/index.html.bcc4c150.js"><link rel="prefetch" href="/blog-project/assets/index.html.0a0a8673.js"><link rel="prefetch" href="/blog-project/assets/index.html.a9cab69d.js"><link rel="prefetch" href="/blog-project/assets/index.html.feebd67b.js"><link rel="prefetch" href="/blog-project/assets/index.html.920571f2.js"><link rel="prefetch" href="/blog-project/assets/index.html.0ff7e736.js"><link rel="prefetch" href="/blog-project/assets/index.html.fd47c9d4.js"><link rel="prefetch" href="/blog-project/assets/index.html.47dd8cbd.js"><link rel="prefetch" href="/blog-project/assets/index.html.9064093f.js"><link rel="prefetch" href="/blog-project/assets/index.html.288718ee.js"><link rel="prefetch" href="/blog-project/assets/index.html.b6e57977.js"><link rel="prefetch" href="/blog-project/assets/index.html.4463cc1c.js"><link rel="prefetch" href="/blog-project/assets/index.html.da64244c.js"><link rel="prefetch" href="/blog-project/assets/index.html.deb6db1f.js"><link rel="prefetch" href="/blog-project/assets/index.html.b3b338fa.js"><link rel="prefetch" href="/blog-project/assets/index.html.ad52ff6b.js"><link rel="prefetch" href="/blog-project/assets/index.html.eff48653.js"><link rel="prefetch" href="/blog-project/assets/index.html.6bc863dc.js"><link rel="prefetch" href="/blog-project/assets/index.html.d093fa6b.js"><link rel="prefetch" href="/blog-project/assets/index.html.098e1930.js"><link rel="prefetch" href="/blog-project/assets/index.html.9e2b18eb.js"><link rel="prefetch" href="/blog-project/assets/index.html.7405d41a.js"><link rel="prefetch" href="/blog-project/assets/index.html.5bfb7e9e.js"><link rel="prefetch" href="/blog-project/assets/index.html.05ec6912.js"><link rel="prefetch" href="/blog-project/assets/index.html.0f5525ad.js"><link rel="prefetch" href="/blog-project/assets/hpjs01.html.255c37a6.js"><link rel="prefetch" href="/blog-project/assets/hpjs02.html.aa96672e.js"><link rel="prefetch" href="/blog-project/assets/hpjs03.html.79f553d8.js"><link rel="prefetch" href="/blog-project/assets/hpjs04.html.3c9405dc.js"><link rel="prefetch" href="/blog-project/assets/hpjs05.html.62fec3c4.js"><link rel="prefetch" href="/blog-project/assets/hpjs06.html.1b3e1713.js"><link rel="prefetch" href="/blog-project/assets/hpjs07.html.582f90f7.js"><link rel="prefetch" href="/blog-project/assets/hpjs08.html.21d2cb65.js"><link rel="prefetch" href="/blog-project/assets/Node の MongoDB Driver.html.4b731a82.js"><link rel="prefetch" href="/blog-project/assets/node の SQLite.html.9e61d2a5.js"><link rel="prefetch" href="/blog-project/assets/Node1.html.e8788cbe.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：V8内存分配.html.55007f4b.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：内存控制（下）.html.bdaab106.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：包与NPM.html.6aec911c.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：异步I!O （上）.html.1ac6ed9a.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：异步I!O （下）.html.8a500945.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：异步I!O （中）.html.2d701d8e.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：文件系统.html.1a251c6f.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：模块.html.2843218c.js"><link rel="prefetch" href="/blog-project/assets/NodeJs深入浅出之旅：理解Buffer.html.55a83504.js"><link rel="prefetch" href="/blog-project/assets/node爬虫爬取小说章节.html.ad743eb0.js"><link rel="prefetch" href="/blog-project/assets/Node连接MongoDB（一）.html.32ef1a0f.js"><link rel="prefetch" href="/blog-project/assets/SocketIO の 聊天练习.html.57d1737d.js"><link rel="prefetch" href="/blog-project/assets/Three.Js杂记1.html.d771d6a2.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记10.html.d8ee7d1e.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记11.html.51d148fa.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记12.html.a2624d9a.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记2.html.5a258b4a.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记3.html.ad02e509.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记4.html.925e7066.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记5.html.298d5bb9.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记6.html.9a5f8bb6.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记7.html.2b8efe50.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记8.html.28c773e6.js"><link rel="prefetch" href="/blog-project/assets/Three.js杂记9.html.4f031c03.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの一.html.cce22b24.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの七：函数.html.2e196779.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの三：TS的类型.html.868ea6de.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの九：接口Interfaces · 中.html.e27295e4.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの二.html.6c0fd571.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの五：webpack打包typescript.html.a99d5f5f.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの八：类.html.e6ff217c.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの六：webpack5热更新打包TS.html.a4192a05.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十一：模块和命名空间.html.cb8ba6ee.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十三： infer、extends、keyof、typeof、in.html.82b21f08.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十二：装饰器.html.bfa3e84b.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの十：泛型.html.cdc7589e.js"><link rel="prefetch" href="/blog-project/assets/从0开始的TypeScriptの四：接口Interfaces · 上.html.58ad2fee.js"><link rel="prefetch" href="/blog-project/assets/404.html.544e4394.js"><link rel="prefetch" href="/blog-project/assets/index.html.76aa15ef.js"><link rel="prefetch" href="/blog-project/assets/index.html.548aab9c.js"><link rel="prefetch" href="/blog-project/assets/index.html.469bd549.js"><link rel="prefetch" href="/blog-project/assets/index.html.a49d1b3b.js"><link rel="prefetch" href="/blog-project/assets/index.html.4ac9df1d.js"><link rel="prefetch" href="/blog-project/assets/index.html.2ff0a2f4.js"><link rel="prefetch" href="/blog-project/assets/index.html.ea4214cb.js"><link rel="prefetch" href="/blog-project/assets/index.html.5be4dbed.js"><link rel="prefetch" href="/blog-project/assets/index.html.680f1074.js"><link rel="prefetch" href="/blog-project/assets/index.html.85719214.js"><link rel="prefetch" href="/blog-project/assets/index.html.6d3094d5.js"><link rel="prefetch" href="/blog-project/assets/index.html.d1e0d5b0.js"><link rel="prefetch" href="/blog-project/assets/index.html.441bc6dd.js"><link rel="prefetch" href="/blog-project/assets/index.html.ad35497b.js"><link rel="prefetch" href="/blog-project/assets/index.html.ccef27e7.js"><link rel="prefetch" href="/blog-project/assets/index.html.5d46413e.js"><link rel="prefetch" href="/blog-project/assets/index.html.3719158c.js"><link rel="prefetch" href="/blog-project/assets/index.html.9975894c.js"><link rel="prefetch" href="/blog-project/assets/index.html.bc16eecb.js"><link rel="prefetch" href="/blog-project/assets/index.html.01b1b28e.js"><link rel="prefetch" href="/blog-project/assets/index.html.0dbe03ae.js"><link rel="prefetch" href="/blog-project/assets/index.html.bcdc4e24.js"><link rel="prefetch" href="/blog-project/assets/index.html.9880b030.js"><link rel="prefetch" href="/blog-project/assets/index.html.c54d690e.js"><link rel="prefetch" href="/blog-project/assets/index.html.94789cbb.js"><link rel="prefetch" href="/blog-project/assets/index.html.1d6a1b23.js"><link rel="prefetch" href="/blog-project/assets/index.html.c22ceda5.js"><link rel="prefetch" href="/blog-project/assets/index.html.aef10161.js"><link rel="prefetch" href="/blog-project/assets/index.html.fc150d4f.js"><link rel="prefetch" href="/blog-project/assets/index.html.bff15deb.js"><link rel="prefetch" href="/blog-project/assets/index.html.14be7a6c.js"><link rel="prefetch" href="/blog-project/assets/index.html.5476824f.js"><link rel="prefetch" href="/blog-project/assets/404.20713f45.js"><link rel="prefetch" href="/blog-project/assets/Categories.d7596ff9.js"><link rel="prefetch" href="/blog-project/assets/Layout.4b9a0478.js"><link rel="prefetch" href="/blog-project/assets/Post.2a959357.js"><link rel="prefetch" href="/blog-project/assets/Timeline.5d86b7c8.js"><link rel="prefetch" href="/blog-project/assets/reco-valine.88224ab5.js">
    <link rel="stylesheet" href="/blog-project/assets/style.e20c9983.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper"><div><header class="navbar-container"><span class="nav-item site-brand"><a href="/blog-project/" class=""><img class="logo" src="/blog-project/img/icon.svg" alt="空城机の博文"><span class="site-name can-hide">空城机の博文</span></a></span><div class="nav-item navbar-links-wrapper" style=""><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/blog-project/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博客专栏">博客专栏 <span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="博客专栏"><span class="title"><span>博客专栏</span></span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-project/docs/highPerformanceJavaScript/hpjs01" class="nav-link" aria-label="高性能JavaScript"><!--[--><!--]--> 高性能JavaScript <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-project/docs/nodeblog/Node1" class="nav-link" aria-label="node学习"><!--[--><!--]--> node学习 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-project/docs/typescript/cong0kaishideTypeScriptのyi" class="nav-link" aria-label="Typescript学习"><!--[--><!--]--> Typescript学习 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-project/docs/threeJs/Three.Jszaji1" class="nav-link" aria-label="ThreeJs学习"><!--[--><!--]--> ThreeJs学习 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a href="/blog-project/tags/gaoxingnenJavaScript/1/" class="nav-link" aria-label="标签索引"><!--[--><!--]--> 标签索引 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="关于我">关于我 <span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="关于我"><span class="title"><span>关于我</span></span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link" href="https://blog.csdn.net/qq_36171287" target="_blank" rel="noopener noreferrer" aria-label="CSDN"><!--[--><!--]--> CSDN <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://juejin.cn/user/2357005414307127" target="_blank" rel="noopener noreferrer" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://gitee.com/wzckongchengji" target="_blank" rel="noopener noreferrer" aria-label="码云"><!--[--><!--]--> 码云 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://github.com/kongchengji" target="_blank" rel="noopener noreferrer" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://www.infoq.cn/u/kongchengji/publish" target="_blank" rel="noopener noreferrer" aria-label="infoQ"><!--[--><!--]--> infoQ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://bbs.huaweicloud.com/community/usersnew/id_1628347319379041" target="_blank" rel="noopener noreferrer" aria-label="华为云"><!--[--><!--]--> 华为云 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><a class="icon-container left btn-toggle-dark-mode" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:19px;height:19px;font-size:19px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"></path><path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0-2 2a2 2 0 0 0-2-2a2 2 0 0 0 2-2"></path><path d="M19 11h2m-1-1v2"></path></g></svg><!----></a><a class="icon-container left btn-toggle-menus" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:20px;height:20px;font-size:20px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="19" r="1"></circle><circle cx="12" cy="5" r="1"></circle></g></svg><!----></a></div></header><div class="mobile-menus-container"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/blog-project/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="博客专栏">博客专栏 <span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="博客专栏"><span class="title"><span>博客专栏</span></span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/blog-project/docs/highPerformanceJavaScript/hpjs01" class="nav-link" aria-label="高性能JavaScript"><!--[--><!--]--> 高性能JavaScript <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-project/docs/nodeblog/Node1" class="nav-link" aria-label="node学习"><!--[--><!--]--> node学习 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-project/docs/typescript/cong0kaishideTypeScriptのyi" class="nav-link" aria-label="Typescript学习"><!--[--><!--]--> Typescript学习 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/blog-project/docs/threeJs/Three.Jszaji1" class="nav-link" aria-label="ThreeJs学习"><!--[--><!--]--> ThreeJs学习 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a href="/blog-project/tags/gaoxingnenJavaScript/1/" class="nav-link" aria-label="标签索引"><!--[--><!--]--> 标签索引 <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="关于我">关于我 <span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="关于我"><span class="title"><span>关于我</span></span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link" href="https://blog.csdn.net/qq_36171287" target="_blank" rel="noopener noreferrer" aria-label="CSDN"><!--[--><!--]--> CSDN <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://juejin.cn/user/2357005414307127" target="_blank" rel="noopener noreferrer" aria-label="掘金"><!--[--><!--]--> 掘金 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://gitee.com/wzckongchengji" target="_blank" rel="noopener noreferrer" aria-label="码云"><!--[--><!--]--> 码云 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://github.com/kongchengji" target="_blank" rel="noopener noreferrer" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://www.infoq.cn/u/kongchengji/publish" target="_blank" rel="noopener noreferrer" aria-label="infoQ"><!--[--><!--]--> infoQ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link" href="https://bbs.huaweicloud.com/community/usersnew/id_1628347319379041" target="_blank" rel="noopener noreferrer" aria-label="华为云"><!--[--><!--]--> 华为云 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><div class="appearance"><span>Appearance </span><a class="icon-container left btn-toggle-dark-mode" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:19px;height:19px;font-size:19px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"></path><path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0-2 2a2 2 0 0 0-2-2a2 2 0 0 0 2-2"></path><path d="M19 11h2m-1-1v2"></path></g></svg><!----></a></div></div><div class="sidebar-mask"></div><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading active">node学习专栏</h5><ul><li><!--[--><a href="/blog-project/docs/nodeblog/Node1.html" class="nav-link series-item" aria-label="Node.js学习（一）——简介"><!--[--><!--]--> Node.js学习（一）——简介 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：mokuai.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：模块🌀"><!--[--><!--]--> NodeJs深入浅出之旅：模块🌀 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：baoyuNPM.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：包与NPM 🌛"><!--[--><!--]--> NodeJs深入浅出之旅：包与NPM 🌛 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：yibuI!O （shang）.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：异步I/O （上）🐋"><!--[--><!--]--> NodeJs深入浅出之旅：异步I/O （上）🐋 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：yibuI!O （zhong）.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：异步I/O （中）🐉"><!--[--><!--]--> NodeJs深入浅出之旅：异步I/O （中）🐉 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：yibuI!O （xia）.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：异步I/O （下）🐂"><!--[--><!--]--> NodeJs深入浅出之旅：异步I/O （下）🐂 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：V8nacunfenpei.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：V8内存分配🧙‍♂️"><!--[--><!--]--> NodeJs深入浅出之旅：V8内存分配🧙‍♂️ <!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html" class="router-link-active router-link-exact-active nav-link router-link-active series-item active" aria-label="NodeJs深入浅出之旅：内存控制（上）🐍"><!--[--><!--]--> NodeJs深入浅出之旅：内存控制（上）🐍 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（xia）.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：内存控制（下）🐯"><!--[--><!--]--> NodeJs深入浅出之旅：内存控制（下）🐯 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：wenjianxitong.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：文件系统"><!--[--><!--]--> NodeJs深入浅出之旅：文件系统 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：lijieBuffer.html" class="nav-link series-item" aria-label="NodeJs深入浅出之旅：理解Buffer 🐰"><!--[--><!--]--> NodeJs深入浅出之旅：理解Buffer 🐰 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/SocketIO の liaotianlianxi.html" class="nav-link series-item" aria-label="SocketIO の 聊天练习"><!--[--><!--]--> SocketIO の 聊天练习 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/nodepachongpaquxiaoshuozhangjie.html" class="nav-link series-item" aria-label="node爬虫爬取小说章节"><!--[--><!--]--> node爬虫爬取小说章节 <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/NodelianjieMongoDB（yi）.html" class="nav-link series-item" aria-label="Node连接MongoDB（一）"><!--[--><!--]--> Node连接MongoDB（一） <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/Node の MongoDB Driver.html" class="nav-link series-item" aria-label="Node の MongoDB Driver"><!--[--><!--]--> Node の MongoDB Driver <!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-project/docs/nodeblog/node の SQLite.html" class="nav-link series-item" aria-label="node の SQLite"><!--[--><!--]--> node の SQLite <!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container show-series show-catalog"><h1 class="page-title">NodeJs深入浅出之旅：内存控制（上）🐍</h1><div class="page-info"><a class="icon-container left" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"></circle><path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"></path></g></svg><span style="color:inherit;font-size:14px;" class="icon-text"><!--[-->kongchengji<!--]--></span></a><a class="icon-container left" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"></circle><path d="M12 7v5l3 3"></path></g></svg><span style="color:inherit;font-size:14px;" class="icon-text"><!--[-->2021-10-25 21:24:14<!--]--></span></a><a class="icon-container left" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><path d="M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span style="color:inherit;font-size:14px;" class="icon-text"><!--[-->node学习<!--]--></span></a><a class="icon-container left" href="javascript:void(0)" target="_self"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" style="color:inherit;width:18px;height:18px;font-size:18px;"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8.5" cy="8.5" r="1" fill="currentColor"></circle><path d="M4 7v3.859c0 .537.213 1.052.593 1.432l8.116 8.116a2.025 2.025 0 0 0 2.864 0l4.834-4.834a2.025 2.025 0 0 0 0-2.864L12.29 4.593A2.025 2.025 0 0 0 10.859 4H7a3 3 0 0 0-3 3z"></path></g></svg><span style="color:inherit;font-size:14px;" class="icon-text"><!--[-->Node.js 前端<!--]--></span></a><!----></div><div class="theme-reco-default-content"><div><hr><hr><p>小知识，大挑战！本文正在参与“<a href="https://juejin.cn/post/7008476801634680869" title="https://juejin.cn/post/7008476801634680869" target="_blank" rel="noopener noreferrer">程序员必备小知识<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>”创作活动。</p><h1 id="内存控制" tabindex="-1"><a class="header-anchor" href="#内存控制" aria-hidden="true">#</a> 内存控制</h1><p><code>JavaScript</code>通过<strong>垃圾回收机制</strong>来进行自动内存管理，使得开发者不需要像<code>C/C++</code>一样在编写代码的过程中时刻关注内存的分配和释放。</p><p>在浏览器中进行开发时，几乎很少有人会遇到垃圾回收对应用构成性能影响的情况。</p><p><code>Node</code>极大地拓宽了<code>JavaScript</code>的应用场景，当主流应用场景从<strong>客户端</strong>延伸到<strong>服务器端</strong>之后，能发现，对于性能敏感的服务器程序，内存管理的好坏、垃圾回收状况是否优良，都会对服务构成影响。</p><h3 id="为什么关注内存问题" tabindex="-1"><a class="header-anchor" href="#为什么关注内存问题" aria-hidden="true">#</a> 为什么关注内存问题</h3><ul><li>防止页面占用内存过大，引起客户端卡顿，甚至无响应（浏览器端）</li><li>Node使用的也是V8，内存对后端服务的性能至关重要。因为服务的持久性，后端容易造成内存溢出</li></ul><hr><h2 id="node与v8" tabindex="-1"><a class="header-anchor" href="#node与v8" aria-hidden="true">#</a> Node与V8</h2><p>在<code>Node</code>中，这一切都与Node的JavaScript执行引擎V8息息相关。 Node在发展历程中离不开V8，在Node的官网介绍中也是说：<code>Node.js 是一个基于 Chrome V8 引擎的 JavaScript 运行时</code></p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c53574bccac24704ae2046ca495b3e0e~tplv-k3u1fbpfcp-watermark.image?" alt="Node官网.png"></p><p>在当初Node创始人<code>Ryan Dahl</code>选择V8作为Node的JavaScript脚本引擎，原因是来自当时第三次浏览器大战，在其中Chrome以JavaScript引擎V8成为性能优异的焦点，并且在接下来的性能跑分中，V8持续领跑。 我曾经在<a href="https://juejin.cn/post/6975821911678779406" target="_blank" rel="noopener noreferrer">《时代变了，程序员の老冤家IE浏览器离场啦？！》<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中讲过前两次大战，第三次大战主要是以<strong>Chrome</strong>的胜利为结束。</p><h2 id="v8引擎" tabindex="-1"><a class="header-anchor" href="#v8引擎" aria-hidden="true">#</a> V8引擎</h2><p>V8引擎的开发领导者是<code>Lars Bak</code>，第一个版本和Chrome的第一版一起在2008年9月2日发布。</p><p><code>Lars Bak</code>的工作履历大部分是从事与虚拟机相关的工作，主要致力于开发高性能的Java虚拟机，开发者的这些经历也让V8诞生时就超越了当时所有的JavaScript虚拟机。</p><p>V8引擎是由C++编写的。</p><p>V8引擎的垃圾回收机制：</p><ul><li>在V8的内存分配中分为堆和栈 <ul><li>栈内存存储基本类型数据以及引用类型数据的内存地址</li><li>堆内存储存引用类型的数据</li></ul></li><li>垃圾回收主要存在于堆的新生代和老生代</li><li>新生代中分为两个空间，<code>Semi space from</code>和<code>Semi space To</code>，这两个空间严格对半分</li><li>老生代:从新生代空间经过至少两轮<code>Minor GC</code>仍然存活下来的数据</li><li>内存大小与操作系统有关，<code>64位</code>是<code>1.4G</code>，<code>32位</code>是<code>0.7G</code><ul><li>64位新生代空间是<code>64MB</code>，老生代为<code>1400MB</code></li><li>32位新生代空间是<code>32MB</code>，老生代为<code>700MB</code></li><li>新版的Node在v14之后，内存已经有2G了</li></ul></li><li>新生代和老生代用的是两种完全不同的垃圾回收机制 <ul><li>新生代<code>Scavenge</code>算法（新生代互换）</li><li>老生代是标记整理清除：<code>Mark-Sweep</code>（标记清除）、 <code>Mark-Compact</code>（标记整理）</li><li>参考链接：<a href="https://blog.csdn.net/weixin_39987434/article/details/115375921" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_39987434/article/details/115375921<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></li></ul><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50d6e216010e4937b8f8de586bf9eaef~tplv-k3u1fbpfcp-watermark.image?" alt="堆和栈.png"></p><div class="language-mermaid ext-mermaid line-numbers-mode"><pre class="language-mermaid"><code><span class="token keyword">graph</span> RL<span class="token punctuation">;</span>
<span class="token keyword">subgraph</span> V8内存分配
<span class="token keyword">subgraph</span> Heap memory堆
<span class="token keyword">subgraph</span> New space新生代
n<span class="token text string">[&quot;是最新产生的数据存活的地方，这些数据往往都是短暂的&quot;]</span>
<span class="token keyword">subgraph</span> Semi space from
处于使用状态的空间
<span class="token keyword">end</span>\
<span class="token keyword">subgraph</span> Semi space To
处于闲置状态的空间
<span class="token keyword">end</span>
<span class="token keyword">end</span>
<span class="token keyword">subgraph</span> Old space老生代
o<span class="token text string">[从新生代空间经过至少两轮Minor GC仍然存活下来的数据]</span>
<span class="token keyword">subgraph</span> Old pointer space
o1<span class="token text string">[&quot;如果一个对象有指针引用或者指向其他对象，那么保存在pointer space&quot;]</span>
<span class="token keyword">end</span>
<span class="token keyword">subgraph</span> Old data space
o2<span class="token text string">[&quot;如果一个对象是一个原始对象，没有指针引用，那么保存在data space&quot;]</span>
<span class="token keyword">end</span>
<span class="token keyword">end</span>
<span class="token keyword">subgraph</span> Large object space大对象空间
d<span class="token text string">[&quot;比空间大小还要大的对象, 大对象不会被gc（垃圾回收）处理&quot;]</span><span class="token arrow operator">--&gt;</span>d1<span class="token text string">[&quot;定义了一个对象，超过了默认定义的大小，那么这个对象就会放在大对象空间中&quot;]</span>
<span class="token keyword">end</span>
<span class="token keyword">subgraph</span> Code space代码空间
d3<span class="token text string">[是JIT所编译的代码]</span> <span class="token arrow operator">--&gt;</span> 除了在大对象空间中分配代码并执行之外的唯一可执行的空间
<span class="token keyword">end</span>
<span class="token keyword">end</span>

<span class="token keyword">subgraph</span> Stack栈
栈内存存储基本类型数据以及引用类型数据的内存地址
<span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="新生代scavenge算法" tabindex="-1"><a class="header-anchor" href="#新生代scavenge算法" aria-hidden="true">#</a> 新生代<code>Scavenge</code>算法</h3><p>新生代存的都是生存周期短的对象，分配内存也很容易，只保存一个指向内存空间的指针，根据分配对象的大小递增指针就可以了，<strong>当存储空间快要满时，就进行一次垃圾回收</strong></p><p>之前说过新生代中分为两个空间，<code>Semi space from</code>使用状态空间和<code>Semi space To</code>闲置状态空间。</p><p>垃圾回收过程：</p><ol><li>当定义三个变量A、B、C时，会在<code>from</code>使用状态空间中开辟位置进行存储。</li></ol><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e26172d9956a4652a09bbba65d95f8a4~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ol start="2"><li>当<code>from</code>空间将满时，进行垃圾回收判断，发现B没有被其他引用，可以回收，对B进行标记</li></ol><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1c984128a8324ea7a9adccf911b67ee5~tplv-k3u1fbpfcp-watermark.image?" alt="scavenge2.png"></p><ol start="3"><li>将没有被标记的A、C拷贝到<code>To</code>闲置空间当中</li></ol><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43e72f0592d0467882a7caf8638a75ad~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p><ol start="4"><li>清除掉<code>from</code>空间中的全部内容</li></ol><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/068d79fffff64c0296313d2264182912~tplv-k3u1fbpfcp-watermark.image?" alt="scavenge4.png"></p><ol start="5"><li>将<code>from</code>空间和<code>to</code>空间身份对调，对调后的<code>from</code>空间中就存在A、C，而B消失了。<code>to</code>空间依旧是空的。</li></ol><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc20b3b8490548058ab8927c1393c95b~tplv-k3u1fbpfcp-watermark.image?" alt="scavenge5.png"></p><p>这就是一次新生代当中垃圾回收的过程，由于<code>Scavenge</code>是典型的牺牲空间换取时间的算法，所以无法大规模的应用到所有的垃圾回收中</p><p><code>Scavenge</code>优点：由于只复制存活的对象，并且对于生命周期短的场景存活对象只占少部分，所以它在时间效率上有优异的体现。 <code>Scavenge</code>缺点：只能使用堆内存的一半，这是由划分空间和复制机制所决定的。</p><blockquote><p><strong>写屏障</strong>小知识：</p><ul><li>在GC遍历新生代中对象进行标记时，如果一个对象只有一个指针指向它，并且指针在老生代空间中，如何判断该对象是否活跃？</li><li>如果再去遍历老生代中对象效率太低</li><li>实际上在写缓冲区中有一个列表(我们称之为<code>CrossRefList</code>)，列表中记录了所有老生区对象指向新生区的情况</li><li>当有老生区中的对象出现指向新生区对象的指针时，我们便记录下来这样的跨区指向</li><li>新生成的对象，并不会被记录</li><li>这种记录行为总是发生在写操作时，它被称为写屏障，每个写操作都会进行写屏障</li><li>当新生代GC时遇到这样的对象，就回去读一遍记录列表</li></ul></blockquote><h3 id="新生代晋升到老生代" tabindex="-1"><a class="header-anchor" href="#新生代晋升到老生代" aria-hidden="true">#</a> 新生代晋升到老生代</h3><ul><li>当一个对象经过两次以上复制仍然存活时，它就会被认为是生命周期较长的对象。</li><li>并且当新生代内存空间一旦超过占用临界值，这种较长生命周期的对象随后会被移动到老生代中，采用新的算法进行管理。</li></ul><h3 id="老生代标记整理清除" tabindex="-1"><a class="header-anchor" href="#老生代标记整理清除" aria-hidden="true">#</a> 老生代标记整理清除</h3><p>由于老生代中内存大，存放的对象多，所以不能像新生代一样使用<code>Scavenge</code>。</p><p>原因：</p><ul><li>空间对半分太过浪费空间，老生代的占用空间远大于新生代，浪费会非常严重</li><li>存活对象较多，复制存活对象的效率会很低</li></ul><h4 id="mark-sweep标记清除" tabindex="-1"><a class="header-anchor" href="#mark-sweep标记清除" aria-hidden="true">#</a> Mark-Sweep标记清除</h4><p>标记清除<strong>Mark-Sweep</strong>图示：</p><p>第一步：进行标记，从一组<strong>根元素</strong>开始<code>广度遍历</code>递归这组根元素，在这个遍历过程中，能够到达的元素为活动对象，到达不了的元素可以判断为非活动对象，也就是垃圾数据，将非活动对象进行标记。 第二步：灰色部分是垃圾回收前被标记的需回收数据，垃圾回收后，灰色部分被清理掉。</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c94ed614a3e34a47bad702526d8b0121~tplv-k3u1fbpfcp-watermark.image?" alt="标记清除.png"></p><h4 id="mask-compact标记整理" tabindex="-1"><a class="header-anchor" href="#mask-compact标记整理" aria-hidden="true">#</a> Mask-Compact标记整理</h4><p>但是这种方式清理回收后，会产生大量的内存碎片，这样会导致如果有一个对象需要一块大的连续的内存出现内存不足的情况。</p><p>此时就需要第二种标记整理<strong>Mask-Compact</strong>算法出场了。</p><p>标记的步骤是一样的，只是后续不是直接对垃圾数据清理，而是先将所有存活的对象向一端移动，然后直接清理掉这一端以外的内存</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8751201d82374a3fbdccbadc1862368b~tplv-k3u1fbpfcp-watermark.image?" alt="标记整理.png"></p><p>虽然Mask-Compact标记整理看起来比标记清除更加清晰，对空间利用率更高，但在老生代当中，是这两种方式结合使用的，<strong>因为</strong>Mark-Conpact需要移动对象，所以它的执行速度不可能很快</p><h4 id="三色标记法" tabindex="-1"><a class="header-anchor" href="#三色标记法" aria-hidden="true">#</a> 三色标记法</h4><p>三色为：</p><ul><li>白：未被标记的对象，即不可达对象（没有扫描到的对象），可回收</li><li>灰：已被标记的对象（可达对象），但是对象还没有被扫描完，不可回收</li><li>黑：已被扫描完（可达对象，活动对象），不可回收</li></ul><p>参考文章：<a href="https://blog.csdn.net/star1210644725/article/details/115712443" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/star1210644725/article/details/115712443<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="清理效率" tabindex="-1"><a class="header-anchor" href="#清理效率" aria-hidden="true">#</a> 清理效率</h3><h4 id="全停顿" tabindex="-1"><a class="header-anchor" href="#全停顿" aria-hidden="true">#</a> 全停顿</h4><p>由于垃圾回收是在JS引擎中进行的，而<code>Mark-Compact算法</code>在执行过程中需要移动对象，而当活动对象较多的时候，它的执行速度不可能很快，为了避免<code>JavaScript</code>应用逻辑和垃圾回收器的内存资源竞争导致的不一致性问题，垃圾回收器会将<code>JavaScript</code>应用暂停，这个过程，被称为<code>全停顿（stop-the-world）</code>。</p><p>这也是<code>JavaScript</code>单线程导致的，<code>JavaScript</code>运行在主线程上，进行垃圾回收就会导致<code>JavaScript</code>运行停止。</p><p>对于新生代，全停顿影响效率不大，但是在老生代中，因为活动对象众多，所以标记整理清除时间较长，全停顿很影响效率，会暂停主线程较长的时间，使得页面变得卡顿。</p><p>目前<code>v8</code>引擎已经采用<strong>增量标记</strong>、<strong>并行回收</strong>、<strong>并发回收</strong>等技术来替代全停顿。</p><p>这里有关这几种优化技术可参考：</p><ul><li><a href="https://blog.csdn.net/weixin_34409741/article/details/91393265" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_34409741/article/details/91393265<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.cnblogs.com/cangqinglang/p/14214864.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/cangqinglang/p/14214864.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><p>面试会遇到的问题：</p><ul><li>为什么要整理？ <ul><li>如果单纯标记清除，会造成大量碎片化空间，如果对象需要的连续内存大就会出错</li></ul></li><li>标记整理方法为什么先整理后清除？ <ul><li>整理时活动对象会覆盖掉部分标记对象，之后进行清除时就可以减少一次性需要清除的标记对象，减少了空间复杂度</li></ul></li></ul></blockquote><hr><h2 id="网页渲染流程" tabindex="-1"><a class="header-anchor" href="#网页渲染流程" aria-hidden="true">#</a> 网页渲染流程</h2><p><code>Node</code>在<code>JavaScript</code>的执行直接受益于<code>V8</code>，并且可以随着V8升级就享受到新的语言特性（<code>ES6</code>），但是同时也会受到<code>V8</code>的一些限制。</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a46f799239f140bc97684cb15372af67~tplv-k3u1fbpfcp-watermark.image?" alt="网页访问.png"></p><h3 id="v8的内存限制" tabindex="-1"><a class="header-anchor" href="#v8的内存限制" aria-hidden="true">#</a> V8的内存限制</h3><p>在一般的后端开发语言中，基本的内存使用上没有什么限制，然而在Node中，通过JavaScript使用内存会发现只能使用部分内存。</p><p><strong>对于V8限制堆大小的原因</strong></p><ul><li>V8最初是为了浏览器设计的，不可能遇到用大量内存的原因</li><li>V8垃圾回收机制的限制，以1.5G的垃圾回收堆内存为例，V8做一次小的垃圾回收需要50毫秒以上，做一次非增量式的垃圾回收甚至需要1秒以上</li><li>可以手动调节内存限制，Node使用<code>--max-old-space-size</code>或者<code>--max-new-space-size</code>可以调整内存限制的大小</li></ul></div></div><footer class="page-meta"><!----><!----></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← NodeJs深入浅出之旅：V8内存分配🧙‍♂️</span><span class="page-nav-item next">NodeJs深入浅出之旅：内存控制（下）🐯 → </span></p></nav><!----></main><!--]--><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#为什么关注内存问题" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="为什么关注内存问题"><!--[--><!--]--> 为什么关注内存问题 <!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#node与v8" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="Node与V8"><!--[--><!--]--> Node与V8 <!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#v8引擎" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="V8引擎"><!--[--><!--]--> V8引擎 <!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#新生代scavenge算法" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="新生代Scavenge算法"><!--[--><!--]--> 新生代Scavenge算法 <!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#新生代晋升到老生代" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="新生代晋升到老生代"><!--[--><!--]--> 新生代晋升到老生代 <!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#老生代标记整理清除" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="老生代标记整理清除"><!--[--><!--]--> 老生代标记整理清除 <!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#清理效率" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="清理效率"><!--[--><!--]--> 清理效率 <!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#网页渲染流程" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="网页渲染流程"><!--[--><!--]--> 网页渲染流程 <!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-project/docs/nodeblog/NodeJsshenruqianchuzhilv：nacunkongzhi（shang）.html#v8的内存限制" class="router-link-active router-link-exact-active nav-link page-catalog-item" aria-label="V8的内存限制"><!--[--><!--]--> V8的内存限制 <!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/blog-project/assets/app.44e72aae.js" defer></script>
  </body>
</html>
